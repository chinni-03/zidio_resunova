import React, { useEffect, useState } from "react";
import { Link, useParams } from "react-router-dom";
import Nav from "./Nav";
import Panel from "./Panel";
import GetStartedBtn from "../homepage/GetStartedBtn";
import Resume from "./Resume/Resume";
import Resume2 from "./Resume2/Resume2";
import RoundBtn from "../RoundBtn";
import { useEducation } from "../../context/resumeContext/education_details";
import { ToastContainer } from "react-toastify";

export default function EduDetails() {
    const { educationdata, handleOnChange } = useEducation();

    useEffect(() => {
        document.title = "Resume Builder";
    }, []);

    const initialdetails = {
        title: "Education Details",
        institute: "Institute name",
        qualification: "Qualification",
        subject: "Subject",
        startgraduyear: "Start year",
        startgradumonth: "Start month",
        endgraduyear: "End year",
        endgradumonth: "End month",
    };

    const [educationinputs, setEducationinputs] = useState([initialdetails]);

    const addMoreSections = () => {
        setEducationinputs([...educationinputs, initialdetails]);
    };

    const deleteSections = (index) => {
        const updatedSections = [...educationinputs];
        updatedSections.splice(index, 1);
        setEducationinputs(updatedSections);
    };

    const { resumeType } = useParams();

    const render = () => {
        if (resumeType === "resume") {
            return <Resume />;
        } else if (resumeType === "resume2") {
            return <Resume2 />;
        }
    };

    return (
        <>
            <Nav />
            <div className="main-page">
                <div className="fillers">
                    <Panel page="edu" resume={resumeType} />
                    <div className="form">
                        {educationinputs.map((details, index) => (
                            <div key={index} className="education-section">
                                {Object.keys(details).map((key, idx) => {
                                    if (key === 'title' || key === 'subtitle') {
                                        if (key === 'subtitle') {
                                            return <p className="subtitle" key={idx}>{details[key]}</p>;
                                        }
                                        return <p className="title" key={idx}>{details[key]}</p>;
                                    }

                                    const isLinkField = key === 'startgraduyear' || key === 'startgradumonth' || key === 'endgraduyear' || key === 'endgradumonth';

                                    return (
                                        <div key={idx} className="inputs">
                                            <label htmlFor={key} className="resume-label">{details[key]}</label>
                                            <input
                                                className="resume-input"
                                                type={isLinkField ? 'number' : 'text'}
                                                value={educationdata[index] ? educationdata[index][key] : ''}
                                                onChange={(e) => handleOnChange(index, e)}
                                                id={key}
                                                name={key}
                                            />
                                        </div>
                                    );
                                })}
                                {index > 0 && (
                                    <button type="button" className="w-100" onClick={() => deleteSections(index)}>
                                        <GetStartedBtn extraClass="add red-btn align-right" btn="Remove" />
                                    </button>
                                )}
                            </div>
                        ))}
                        <div className="btns">
                            <Link className="w-50" type="button" to={`/experience-details/${resumeType}`}>
                                <GetStartedBtn extraClass="add align-left w-50" btn="Next" />
                            </Link>
                            <button type="button" className="w-50" onClick={addMoreSections}>
                                <GetStartedBtn extraClass="add w-50 align-right transparent" btn="Add more" />
                            </button>
                        </div>
                    </div>
                </div>
                <div className="res-parent">
                    {render()}
                </div>
                <RoundBtn />
                <ToastContainer />
            </div>
        </>
    );
}

